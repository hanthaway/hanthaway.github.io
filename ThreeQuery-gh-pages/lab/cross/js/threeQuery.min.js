var threeQuery=function(){this.global={};this.global.camera;this.global.world;this.global.canvasDom;this.global.canvasContainerDom=document.body;this.global.renderer;this.global.vrEffect;this.getWorldWidth=function(){return this.global.canvasContainerDom==document.body?window.innerWidth:this.global.canvasContainerDom.offsetWidth};this.getWorldHeight=function(){return this.global.canvasContainerDom==document.body?window.innerHeight:this.global.canvasContainerDom.offsetHeight};this.rightButtonEvent=function(a){this.global.canvasContainerDom.oncontextmenu=function(b){a&&a(b);b.preventDefault()}};this.resize=function(){var a=this.getWorldWidth(),b=this.getWorldHeight();"PerspectiveCamera"==this.global.settings.camera.type?(this.global.camera.aspect=a/b,this.global.camera.updateProjectionMatrix()):(this.global.camera.left=-a/2,this.global.camera.right=a/2,this.global.camera.top=b/2,this.global.camera.bottom=-b/2);this.global.renderer.setSize(a,b);$$.global.settings.vr&&$$.global.vrEffect&&this.global.vrEffect.setSize(a,b)};this.setCommonCSS=function(){document.write("<style>*{margin:0;padding:0} body{overflow:hidden}</style>")};this.createWorld=function(a){a=new THREE.Scene;this.global.world||(this.global.world=a);return a};this.createFog=function(a,b){a=a||{color:16777215,concentration:.01};var c=b||this.global.world;c.fog=new THREE.FogExp2(a.color||0,a.concentration||0);return c.fog};this.createRenderer=function(a){a=this.extends({},[this.global.settings.render,a]);a=new THREE.WebGLRenderer(a);a.setSize(this.getWorldWidth(),this.getWorldHeight());this.global.renderer||(this.global.renderer=a,this.global.canvasContainerDom.appendChild(this.global.renderer.domElement),$$.global.settings.vr&&(this.global.vrEffect=new THREE.StereoEffect(this.global.renderer)),this.global.canvasDom=this.global.renderer.domElement);return a};this.createCamera=function(a){a=this.extends({},[this.global.settings.camera,a]);a="OrthographicCamera"!=a.type?new THREE.PerspectiveCamera(a.fov,a.aspect,a.near,a.far):new THREE.OrthographicCamera(a.left,a.right,a.top,a.bottom,a.near,a.far);this.global.camera||(this.global.camera=a);return a};this.init=function(a,b,c){this.setCommonCSS();this.createWorld(a);this.createRenderer(b);this.createCamera(c);this.addEventListener();return[this.global.world,this.global.renderer,this.global.camera]};this.addEventListener=function(){function a(a){$$.global.isDown=!0;$$.global.selectedObj&&$$.global.selectedObj.object&&($$.global.selectedObj.object.isDown=!0);if($$.global.selectedObj&&$$.global.selectedObj.object.onDown)$$.global.selectedObj.object.onDown($$.global.selectedObj,a);$$.global.isCenterDown=!0;$$.global.centerSelectedObj&&$$.global.centerSelectedObj.object&&($$.global.centerSelectedObj.object.isCenterDown=!0);if($$.global.centerSelectedObj&&$$.global.centerSelectedObj.object.onCenterDown)$$.global.centerSelectedObj.object.onCenterDown($$.global.centerSelectedObj,a)}function b(a){$$.global.isDown=!1;if($$.global.selectedObj&&$$.global.selectedObj.object.onUp&&1==$$.global.selectedObj.object.isDown)$$.global.selectedObj.object.onUp($$.global.selectedObj,a);$$.global.isCenterDown=!1;if($$.global.centerSelectedObj&&$$.global.centerSelectedObj.object.onCenterUp&&1==$$.global.centerSelectedObj.object.isCenterDown)$$.global.centerSelectedObj.object.onCenterUp($$.global.centerSelectedObj,a)}$$.global.canvasContainerDom.addEventListener("click",function(a){$$.global.selectedObj&&$$.global.selectedObj.object.onClick&&1==$$.global.selectedObj.object.isDown&&($$.global.selectedObj.object.isDown=!1,$$.global.selectedObj.object.onClick($$.global.selectedObj,a));$$.global.centerSelectedObj&&$$.global.centerSelectedObj.object.onCenterClick&&1==$$.global.centerSelectedObj.object.isCenterDown&&($$.global.centerSelectedObj.object.isCenterDown=!1,$$.global.centerSelectedObj.object.onCenterClick($$.global.centerSelectedObj,a))});$$.global.canvasContainerDom.addEventListener("mousemove",function(a){a.preventDefault();$$.global.mouse.x=a.clientX/window.innerWidth*2-1;$$.global.mouse.y=2*-(a.clientY/window.innerHeight)+1;if($$.global.selectedObj&&$$.global.selectedObj.object.onDrag&&$$.global.isDown)$$.global.selectedObj.object.onDrag($$.global.selectedObj)});$$.global.canvasContainerDom.addEventListener("mousedown",a);$$.global.canvasContainerDom.addEventListener("mouseup",b);$$.global.canvasContainerDom.addEventListener("touchstart",a);$$.global.canvasContainerDom.addEventListener("touchend",b)};this.animate=function(){requestAnimationFrame($$.animate);if(!$$.global.settings.renderPause){$$.global.settings.resize&&$$.resize();$$.worldActions();for(var a in $$.actionInjections)if(1==$$.actionInjections[a]instanceof Function)$$.actionInjections[a]();$$.global.raycaster.setFromCamera($$.global.mouse,$$.global.camera);a=$$.global.raycaster.intersectObjects($$.global.world.children);for(var b,c=0;c<a.length;c++)a[c].isPenetrated||(b=a[c]);if(b)if(null==$$.global.selectedObj||$$.global.selectedObj.object.uuid!=b.object.uuid){if($$.global.selectedObj&&$$.global.selectedObj.object.uuid!=b.object.uuid&&$$.global.selectedObj.object.onLeave)$$.global.selectedObj.object.onLeave($$.global.selectedObj);$$.global.selectedObj=b;if($$.global.selectedObj.object.onEnter)$$.global.selectedObj.object.onEnter($$.global.selectedObj)}else $$.global.selectedObj=b;else if($$.global.selectedObj){if($$.global.selectedObj.object.onLeave)$$.global.selectedObj.object.onLeave($$.global.selectedObj);$$.global.selectedObj=null}b=new THREE.Vector2(0,0);$$.global.centerRaycaster.setFromCamera(b,$$.global.camera);b=$$.global.centerRaycaster.intersectObjects($$.global.world.children);var d;for(a=0;a<b.length;a++)b[a].isPenetrated||(d=b[a]);if(d)if(null==$$.global.centerSelectedObj||$$.global.centerSelectedObj.object.uuid!=d.object.uuid){if($$.global.centerSelectedObj&&$$.global.centerSelectedObj.object.uuid!=d.object.uuid&&$$.global.centerSelectedObj.object.onCenterLeave)$$.global.centerSelectedObj.object.onCenterLeave($$.global.centerSelectedObj);$$.global.centerSelectedObj=d;if($$.global.centerSelectedObj.object.onCenterEnter)$$.global.centerSelectedObj.object.onCenterEnter($$.global.centerSelectedObj)}else $$.global.centerSelectedObj=d;else if($$.global.centerSelectedObj){if($$.global.centerSelectedObj.object.onCenterLeave)$$.global.centerSelectedObj.object.onCenterLeave($$.global.centerSelectedObj);$$.global.centerSelectedObj=null}$$.global.settings.vr?($$.global.vrEffect||($$.global.vrEffect=new THREE.StereoEffect($$.global.renderer)),$$.global.renderer.render($$.global.world,$$.global.camera),$$.global.vrEffect.render($$.global.world,$$.global.camera)):$$.global.renderer.render($$.global.world,$$.global.camera);$$.controls&&$$.controls.update()}};this.actionInjections=[];this.worldActions=function(){};this.extends=function(a,b,c){function d(a,b,c){var f=!0;!1===c&&(f=!1);if(b instanceof Array){var h=0;for(c=b.length;h<c;h++)d(a,b[h],f)}for(h in b)!f&&h in a||(a[h]=b[h]);return a}a=d(a,b,c);for(var f in b)delete a[f];return a};this.global.RESOURCE={textures:{},models:{},sounds:{},fonts:{},unloadedSource:{textures:[],models:[],sounds:[],fonts:[]}};this.global.loadingManager=new THREE.LoadingManager;this.global.loadingManager.onProgress=function(a,b,c){$$.onProgress(a,b,c);if(b==c&&$$.onLoadComplete)$$.onLoadComplete()};this.onProgress=function(){};this.onLoadComplete=function(){};this.loadTexture=function(a){var b=new THREE.TextureLoader(this.global.loadingManager),c={i$0:void 0},d;for(d in a)c.i$0=d,b.load(a[c.i$0],function(b){return function(d){$$.global.RESOURCE.textures[a[b.i$0]]=d}}(c),function(a){},function(b){return function(d){$$.global.RESOURCE.unloadedSource.textures.push(a[b.i$0]);console.log(a[b.i$0]+" is not found")}}(c)),c={i$0:c.i$0}};this.loadFont=function(a){var b=new THREE.FontLoader(this.global.loadingManager),c=new THREE.TTFLoader(this.global.loadingManager),d={i$1:void 0},f;for(f in a){d.i$1=f;var e=a[d.i$1];e.lastIndexOf(".json")==e.length-5?b.load(a[d.i$1],function(b){return function(d){$$.global.RESOURCE.fonts[a[b.i$1]]=d}}(d),function(a){},function(b){return function(d){$$.global.RESOURCE.unloadedSource.textures.push(a[b.i$1]);console.log(a[b.i$1]+" is not found")}}(d)):c.load(a[d.i$1],function(b){return function(d){d=new THREE.Font(d);$$.global.RESOURCE.fonts[a[b.i$1]]=d}}(d),function(a){},function(b){return function(d){$$.global.RESOURCE.unloadedSource.textures.push(a[b.i$1]);console.log(a[b.i$1]+" is not found")}}(d));d={i$1:d.i$1}}};this.openFullScreen=function(){var a=$$.global.canvasContainerDom;$$.global.settings.isFullScreem=!0;a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():$$.global.settings.isFullScreem=!1;return $$.global.settings.isFullScreem};this.closeFullScreen=function(){var a=document;$$.global.settings.isFullScreem=!1;a.exitFullscreen?a.exitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.webkitExitFullScreen?a.webkitExitFullScreen():a.msExitFullscreen?a.msExitFullscreen():a.webkitCancelFullScreen&&a.webkitCancelFullScreen();a.webkitExitFullScreen&&a.webkitCancelFullScreen();return $$.global.settings.isFullScreem};this.toggleFullScreen=function(){$$.global.settings.isFullScreem?this.closeFullScreen():this.openFullScreen()};this.groups={};this.createGroup=function(a){if($$.groups[a])return $$.groups[a];var b=new $$.ThreeGroup(a);return $$.groups[a]=b};this.removeGroup=function(a){if($$.groups[a]){var b=$$.groups[a].children;delete $$.groups[a];return b}return[]};this.global.mouse=new THREE.Vector2;this.global.mouse.x=NaN;this.global.mouse.y=NaN;this.global.raycaster=new THREE.Raycaster;this.global.centerRaycaster=new THREE.Raycaster;this.global.selectedObj=null;this.global.centerSelectedObj=null;this.ThreeGroup=function(a){this.name=a;this.children=[];this.remove=function(a){for(var c in this.children)if(a==this.children[c]){this.splice(c,1);break}};this.push=function(a){for(var c in this.children)if(a==this.children[c])return c;this.children.push(a);return c}};this.get=function(a,b){var c=a.split("="),d=c[1],c=c[0],f=null,e=[];if(b)if("string"==typeof b){if(f=$$.groups[b],!f)return[]}else"object"==typeof b&&(f=b.children);else f=$$.global.world.children;if(f)if("id"==c)for(var g=0;g<f.length;g++){if(f[g].id==d)return f[g]}else{for(g=0;g<f.length;g++)f[g][c]==d&&e.push(f[g]);return e}return[]};this.createSkybox=function(a,b){var c=new THREE.CubeTexture([]);c.format=THREE.RGBFormat;(new THREE.ImageLoader).load(a,function(a){var b=function(b,d){var c=document.createElement("canvas");c.width=1024;c.height=1024;c.getContext("2d").drawImage(a,1024*-b,1024*-d);return c};c.images[0]=b(2,1);c.images[1]=b(0,1);c.images[2]=b(1,0);c.images[3]=b(1,2);c.images[4]=b(1,1);c.images[5]=b(3,1);c.needsUpdate=!0});var d=THREE.ShaderLib.cube;d.uniforms.tCube.value=c;d=new THREE.ShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:d.uniforms,depthWrite:!1,side:THREE.BackSide});d=new THREE.Mesh(new THREE.BoxGeometry(b||1E6,b||1E6,b||1E6),d);scene.add(d);return d};this.createSkydome=function(a,b){var c=new THREE.SphereGeometry(b||1E6,25,25),d=$$.global.RESOURCE.textures[a]||THREE.ImageUtils.loadTexture(a),d=new THREE.MeshBasicMaterial({map:d}),c=new THREE.Mesh(c,d);c.material.side=THREE.BackSide;scene.add(c);return c};this.createSea=function(a){a=$$.extends({},[$$.global.settings.sea,a]);if($$.global.RESOURCE.textures[a.texture])return waterNormals=$$.global.RESOURCE.textures[a.texture],waterNormals.wrapS=waterNormals.wrapT=THREE.RepeatWrapping,water=new THREE.Water(renderer,camera,scene,{textureWidth:waterNormals.image.width,textureHeight:waterNormals.image.height,waterNormals:waterNormals,alpha:a.alpha,waterColor:a.color}),mirrorMesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(a.width,a.height),water.material),mirrorMesh.add(water),mirrorMesh.rotation.x=.5*-Math.PI,scene.add(mirrorMesh),water.waterMesh=mirrorMesh,water;(new THREE.TextureLoader).load(a.texture,function(b){waterNormals=$$.global.RESOURCE.textures[a.texture]=b;waterNormals.wrapS=waterNormals.wrapT=THREE.RepeatWrapping;water=new THREE.Water(renderer,camera,scene,{textureWidth:waterNormals.image.width,textureHeight:waterNormals.image.height,waterNormals:waterNormals,alpha:a.alpha,waterColor:a.color});mirrorMesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(a.width,a.height),water.material);mirrorMesh.add(water);mirrorMesh.rotation.x=.5*-Math.PI;scene.add(mirrorMesh);water.waterMesh=mirrorMesh;$$.actionInjections.push(function(){water.material.uniforms.time.value+=1/60;water.render()});return water},function(a){},function(a){$$.global.RESOURCE.unloadedSource.textures.push(arr[i]);console.log(arr[i]+" is not found")})};this.global.settings={camera:{type:"PerspectiveCamera",fov:90,aspect:this.getWorldWidth()/this.getWorldHeight(),near:1,far:1E4,left:-this.getWorldWidth()/2,right:this.getWorldWidth()/2,top:this.getWorldHeight()/2,bottom:-this.getWorldHeight()/2},render:{alpha:!1,antialias:!0,clearColor:0,depth:!0,logarithmicDepthBuffer:!1,precision:"highp",premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!0},sea:{alpha:1,color:7695,width:1E5,height:1E5},resize:!0,renderPause:!1,vr:!1,showLoadingProgress:!1,isFullScreem:!1}},$$=new threeQuery;$$.Component={drawTextImage:function(a,b){var c=a.split("\n"),d=0,f;for(f in c)d<c[f].length&&(d=c[f].length);var e=$$.extends({},[{fontSize:30,fontFamily:"Courier New",color:"white",textAlign:5,backgroundColor:"red",width:1,height:1,lineHeight:30,x:0,y:0},b]);if(!b.width)for(;e.width<d*e.fontSize;)e.width*=2;if(!b.height)for(d=c.length*e.lineHeight;e.height<d;)e.height*=2;d=document.createElement("canvas");d.width=e.width;d.height=e.height;var g=d.getContext("2d");g.fillStyle=e.backgroundColor;g.fillRect(0,0,e.width,e.height);g.font=e.fontSize+"px "+e.fontFamily;g.fillStyle=e.color;for(f in c)g.fillText(c[f],e.x,e.y+(e.lineHeight*f+e.lineHeight));return d},$$Timer:function(a){this.options=$$.extends({},[{id:"",life:1E3,duration:1E3,onStart:function(){console.log("timer start")},onRepeat:function(){console.log("repeat")},onEnd:function(){console.log("timer end")}},a]);this.id=a.id;this.life=a.life;this.duration=a.duration;this.onStart=a.onStart;this.onRepeat=a.onRepeat;this.onEnd=a.onEnd;this.lastTime;this.nowTime;this.durationTmp=this.elapsedTime=0;this.start=function(){this.lastTime=this.nowTime=performance.now();this.onStart();$$.actionInjections.push(this.update)};var b=this;this.update=function(){b.lastTime=b.nowTime;b.nowTime=performance.now();b.elapsedTime=b.nowTime-b.lastTime;b.life-=b.elapsedTime;if(0>=b.life){b.onEnd();for(var a in $$.actionInjections)if(b.update==$$.actionInjections[a]){$$.actionInjections.splice(a,1);break}}else b.durationTmp+=b.elapsedTime,b.durationTmp>=b.duration&&(b.durationTmp-=b.duration,b.onRepeat())}},createBullet:function(a,b){var c=$$.controls.getObject().position,d=$$.global.centerRaycaster.ray.direction,c={speed:3,life:1E4,position:new THREE.Vector3(c.x,c.y,c.z),direction:new THREE.Vector3(d.x,d.y,d.z)};b=$$.extends({},[c,b]);a.lookAt(b.direction);a.position.x=b.position.x;a.position.y=b.position.y;a.position.z=b.position.z;a.lifeStart=(new Date).getTime();a.life=b.life;$$.global.world.add(a);$$.actionInjections.push(function(){a.position.x+=b.direction.x*b.speed;a.position.y+=b.direction.y*b.speed;a.position.z+=b.direction.z*b.speed;if(a.life<=(new Date).getTime()-a.lifeStart){$$.global.world.remove(a);for(var d in $$.actionInjections)$$.actionInjections[d]==arguments.callee&&$$.actionInjections.splice(d,1)}})}};$$.Controls={createOrbitControls:function(){var a=$$.global.camera,b=new THREE.OrbitControls(a,$$.global.canvasDom);b.rotateUp(Math.PI/4);b.target.set(a.position.x+.1,a.position.y,a.position.z);b.noZoom=!0;b.noPan=!0;return $$.controls=b},createTrackBallControls:function(a){a||(a={});controls=new THREE.TrackballControls($$.global.camera);controls.rotateSpeed=a.rotateSpeed||1;controls.minDistance=a.minDistance||1E3;controls.maxDistance=a.maxDistance||1E3;controls.zoomSpeed=a.zoomSpeed||1;controls.panSpeed=a.panSpeed||1;controls.noZoom=a.noZoom||!1;controls.noPan=a.noPan||!1;controls.dynamicDampingFactor=a.dynamicDampingFactor||.3;controls.staticMoving=a.staticMoving||!1;return $$.controls=controls},createDeviceOrientationControls:function(){var a=new THREE.DeviceOrientationControls($$.global.camera,!0);a.connect();a.update();window.removeEventListener("deviceorientation",$$.extend.createDeviceOrientationControls,!0);window.addEventListener("deviceorientation",$$.extend.createDeviceOrientationControls,!0);return $$.controls=a},createPointerLockControls:function(){var a=new THREE.PointerLockControls($$.global.camera);$$.controls=a;scene.add(a.getObject());a.controlsEnabled=!0;a.enabled=!0;a.update=function(){};return a},createFirstCharacterControls:function(a,b){var c=new THREE.PointerLockControls($$.global.camera);$$.controls=c;scene.add(c.getObject());if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){var d=document.body,f=function(a){document.pointerLockElement===d||document.mozPointerLockElement===d||document.webkitPointerLockElement===d?(c.controlsEnabled=!0,c.enabled=!0,b.style.display="none"):(c.enabled=!1,b.style.display="-webkit-box",b.style.display="-moz-box",b.style.display="box")},e=function(a){b.style.display="-webkit-box";b.style.display="-moz-box";b.style.display="box"};document.addEventListener("pointerlockchange",f,!1);document.addEventListener("mozpointerlockchange",f,!1);document.addEventListener("webkitpointerlockchange",f,!1);document.addEventListener("pointerlockerror",e,!1);document.addEventListener("mozpointerlockerror",e,!1);document.addEventListener("webkitpointerlockerror",e,!1);b.addEventListener("click",function(a){b.style.display="none";d.requestPointerLock=d.requestPointerLock||d.mozRequestPointerLock||d.webkitRequestPointerLock;if(/Firefox/i.test(navigator.userAgent)){var c=function(a){if(document.fullscreenElement===d||document.mozFullscreenElement===d||document.mozFullScreenElement===d)document.removeEventListener("fullscreenchange",c),document.removeEventListener("mozfullscreenchange",c),d.requestPointerLock()};document.addEventListener("fullscreenchange",c,!1);document.addEventListener("mozfullscreenchange",c,!1);d.requestFullscreen=d.requestFullscreen||d.mozRequestFullscreen||d.mozRequestFullScreen||d.webkitRequestFullscreen;d.requestFullscreen()}else d.requestPointerLock()},!1)}else b.innerHTML="Your browser doesn't seem to support Pointer Lock API";c.controlsEnabled=!1;c.moveForward=!1;c.moveBackward=!1;c.moveLeft=!1;c.moveRight=!1;c.canJump=!1;c.prevTime=performance.now();c.velocity=new THREE.Vector3;a&&a.keymove&&(document.addEventListener("keydown",function(a){switch(a.keyCode){case 38:case 87:$$.controls.moveForward=!0;break;case 37:case 65:$$.controls.moveLeft=!0;break;case 40:case 83:$$.controls.moveBackward=!0;break;case 39:case 68:$$.controls.moveRight=!0;break;case 32:!0===$$.controls.canJump&&($$.controls.velocity.y+=350),$$.controls.canJump=!1}},!1),document.addEventListener("keyup",function(a){switch(a.keyCode){case 38:case 87:$$.controls.moveForward=!1;break;case 37:case 65:$$.controls.moveLeft=!1;break;case 40:case 83:$$.controls.moveBackward=!1;break;case 39:case 68:$$.controls.moveRight=!1}},!1));c.prevTime=performance.now();c.update=function(){if($$.controls.controlsEnabled){$$.controls.time=performance.now();var a=($$.controls.time-$$.controls.prevTime)/1E3;$$.controls.velocity.x-=2*$$.controls.velocity.x*a;$$.controls.velocity.z-=2*$$.controls.velocity.z*a;$$.controls.velocity.y-=9.8*100*a;$$.controls.moveForward&&($$.controls.velocity.z-=400*a);$$.controls.moveBackward&&($$.controls.velocity.z+=400*a);$$.controls.moveLeft&&($$.controls.velocity.x-=400*a);$$.controls.moveRight&&($$.controls.velocity.x+=400*a);$$.controls.getObject().translateX($$.controls.velocity.x*a);$$.controls.getObject().translateY($$.controls.velocity.y*a);$$.controls.getObject().translateZ($$.controls.velocity.z*a);10>$$.controls.getObject().position.y&&($$.controls.velocity.y=0,$$.controls.getObject().position.y=10,$$.controls.canJump=!0);$$.controls.prevTime=$$.controls.time}};return c}};$$.Move={Linear:function(a,b,c){this.obj=a;this.speedRate=b;this.targetPosition=c;this.direction={x:this.targetPosition.x-this.obj.position.x,y:this.targetPosition.y-this.obj.position.y,z:this.targetPosition.z-this.obj.position.z};a=$$.unitVector(this.direction);this.speed={x:a.x*b,y:a.y*b,z:a.z*b};this.update=function(){var a=arguments.callee.owner;a.direction={x:a.targetPosition.x-a.obj.position.x,y:a.targetPosition.y-a.obj.position.y,z:a.targetPosition.z-a.obj.position.z};vecLength(a.direction)<a.speedRate?(a.obj.position.x=a.targetPosition.x,a.obj.position.y=a.targetPosition.y,a.obj.position.z=a.targetPosition.z,a.destroy()):(a.obj.position.x+=a.speed.x,a.obj.position.y+=a.speed.y,a.obj.position.z+=a.speed.z)};this.update.owner=this;this.destroy=function(){for(var a=0;a<$$.actionInjections.length;a++)if($$.actionInjections[a]==this.update){$$.actionInjections.splice(a,1);break}}},Surround:function(a,b,c,d){this.angle=0;this.speedRate=c;this.mother=a;this.child=b;this.vVect=d;this.radius=$$.vecLength({x:this.child.position.x-this.mother.position.x,y:this.child.position.y-this.mother.position.y,z:this.child.position.z-this.mother.position.z});this.update=function(){var a={x:this.child.position.x-this.mother.position.x,y:this.child.position.y-this.mother.position.y,z:this.child.position.z-this.mother.position.z},e=$$.vecLength(a);a.x=a.x*this.radius/e;a.y=a.y*this.radius/e;a.z=a.z*this.radius/e;a=$$.crossMulti(a,d);e=$$.vecLength(a);a.x=a.x*c/e;a.y=a.y*c/e;a.z=a.z*c/e;b.position.x+=a.x;b.position.y+=a.y;b.position.z+=a.z;a={x:this.child.position.x-this.mother.position.x,y:this.child.position.y-this.mother.position.y,z:this.child.position.z-this.mother.position.z};e=$$.vecLength(a);a.x=a.x*this.radius/e;a.y=a.y*this.radius/e;a.z=a.z*this.radius/e;this.child.position.x=this.mother.position.x+a.x;this.child.position.y=this.mother.position.y+a.y;this.child.position.z=this.mother.position.z+a.z}}};$$.crossMulti=function(a,b){var c={x:0,y:0,z:0};c.x=a.y*b.z-b.y*a.z;c.y=a.z*b.x-b.z*a.x;c.z=a.x*b.y-b.x*a.y;return c};$$.vecLength=function(a){return Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)};$$.unitVector=function(a){var b=$$.vecLength(a);a.x/=b;a.y/=b;a.z/=b;return a};